# Запуск процесу
Підключення проекту полягає в тому, щоб створити для кожного продукту Zap на підключення (при продажу клієент додається до групи в DrivEd, а також клієенту надсилається вітальне повідомлення), а також для кожного продукту Zap на відключення на випадок скасування підписки.
  
  ## Створення Zap
Бажано створювати Zap до відповідного клієнту у відповідній папці.  
  <img src = "img/new01.png">  
Починаємо зі створення тригеру (це подія, я якої починається виконання Zap)  
  <img src = "img/new02.png">  
Обираємо застосунок Stripe  для обрання тригерів.    
  <img src = "img/new03.png">   
Через те, що це новий клієнт - важливо підключити новий API для   
  <img src = "img/new04.png">  
  
Stripe буде пропонувати дати доступ до тестових даних. **Тестові дані** - інструмент, який дозволяє розібратися із принципами роботи API Stripe, проте він не дозволяє перевіряти реальну роботи flow, адже генеруєтья не за реальними подіями. Тому, якщо є хоча б базовий досвід і достатній рівень обережності, то підключення тестових даних не є необхідним.
  <img src = "img/new05.png">   
  
В акаунті **Stripe** може бути декілька розділів, що відповідають клієентам. Обираємо той, який відповідає тому клієнту для якого налаштовуємо даний **automation**.
  
  <img src = "img/new06.png">   
  
Після вибору облікового запису натискаємо кнопку "**Continue**"
  <img src = "img/new06_2.png">   
  
Low-code системи (в т.ч. і Zapier) мають механізми перевірки взаємодії з зовнішніми сервісами. Для цього перед додаванням будь-якого елементу, що використовує таку взаємодію відбувається його тестування (для тригерів - отримуються дані від зовнішнього сервісу, для дій (actions) на зовнішній сервіс відправляють певні дані і отримується відповідь).  
В даному випадку - відбувається тест тригеру **New Subscription** від **Stripe**.
    
  <img src = "img/new06_3.png">   
  
Для нових облікових записів може не бути зе підписок в обліковому записі:
  <img src = "img/new06_4.png">  
  
Відповідно до цього - треба таку підписку створити, зробивши тестове придбання:  
Для цього створимо купон зі знижкою. Для підписок можлива 100% знижка

  <img src = "img/new06_5.png">  
  
Для підписок можлива 100% знижка
<img src = "img/new06_6.png">  
  
Відповідно для застоусування знижки введемо промокод
<img src = "img/new06_7.png">  
  
Отримуємо повідомлення, що підписка підбулася
<img src = "img/new06_8.png">  
  
Відповідно до цього - бачимо підписку в переліку підписок в **Stripe**.
  <img src = "img/new06_9.png">  
  
Маючи підписку ми можемо повернутися до **Zapier** і ще раз протестувати тригер
<img src = "img/new06_10.png">  
  
В результаті тесутвання **Zapier** отримує інформацію від **Stripe** щодо існуючих підписок. Через те, що така підписка одна ми отримаємо відповідну інформації у відповіді від **Stripe** (1). Для продовження натиснемо відповідну кнопку (2).
  
  <img src = "img/new06_11.png">  
  
При продовженні **Zapier** нас попросить обрати сервіс для **Action**. Це - хороше рішення для UX, адже в будь-якому Zap має бути хоча б 1 action. Тому запропонувати його одразу - зручна можливість, хоча і може збити з пантелику тих, хто робить свій Zap вперше.
  
  <img src = "img/new06_12.png">  
  
В фільтрі є 3 елемента (**Choose fields**, **Choose conditions**, **Enter text or insert data**). Відповідно - ми обираємо джерело даних, уомови порівняння та значення із яким порівнюємо.  
В якості джерела даних ми оберемо поле **Items plan product** яке має код продукта. 
  
  <img src = "img/new06_13.png">  
  
Умовою порівняння оберемо "**Exacly matched**" (співпадає).
  
  <img src = "img/new06_14.png">  
  
В якості параметра візьмемо значення ID продукту **Self Study** (1), який можна взяти в адресному рядку (2), або у відповідному блоці (3).
  
  <img src = "img/new06_15.png">  
  
Отримане значення Product ID додаємо до відповідного поля (1) та натискаємо кнопку **Continue** (2) для продовження.  
  
  <img src = "img/new06_16.png">  
  
  **Zapier** перевіряє створений фільтр із умови успіху видає овідомлення в зеленому блоці (1), після чого ми можемо натиснути "**Continue**" (2) для продовження

  <img src = "img/new06_17.png">  
  
  **Zapier** знову нас запитує про наступний Action

  <img src = "img/new06_18.png">  
  
І ми обираємо **DrivEd** для створення **Action** додавання користувача до групи.
  
  <img src = "img/new11.png">  
  
Якщо підуключення до **DrivEd** відбувається вперге, то ми маємо натиснути кнопку **Select**
  
  <img src = "img/new11_2_1.png">  
  
Проте, може бути така ситуація, коли у вас вже підулючений **DrivEd** для інших проектів. В такому випадку треба все одно підулючити DrivEd по новій. Це потрібно через те, що школу DrivEd виначає за переданим ID. Тобто кожну школу треба підключати окремо.
  
  <img src = "img/new11_2.png">  
  
Значення ID школи ми можемо отримати в **адміністративному обліковому записі** школи, перейдя до підрозділу **General** розділу **Settings**.
  
  <img src = "img/new11_3.png">  
  
В полі API Key ми можемо отримати відповідний ключ школи:
  
  <img src = "img/new11_4.png">  
  
Та додати його в поле, яке відкриється при додаванні нового облікогового запису **DrivEd** до **Stripe**.
  <img src = "img/new11_5.png">  
  
  
Після підключення до відповідної школи (додавання нового облікового запису **DrivEd**) ми можемо використовувати існуючі дії (**actions**). Для DrivEd на момент написання даної інструкції реалізовано 4 дії: додавання (1)/видалення (2) з курсу, та додавання (3)/ видалення(4) з групи.  
В логіці даного Flow нам потрібно **додати користувача до групи**, що відповідає продукту **Self Study**.
  <img src = "img/new13.png">  
  
Після обрання відповідного **action** нам необхідно його налаштувати. Серед налаштувань у нас є 3 поля: **Email**, **Group**, **Stripe customer id**. За **Email** ми визначаємо користувача, за **Group** ми визначаємо групу, до якої будемо додавати цього користувача. Параметр **Stripe customer id** потрібен для того, щоб в особистому кабіренті **DrivEd** працювало особисте посилання користувача на **Customer Portal** від **Stripe**, за допомогою якого користувач може керувати власною підпискою (змінити термін підписки, змінити продукт, або скасувати підписку).
  
  <img src = "img/new14.png">  
  
  **Email** обираємо як значення поля "**Customer Email**" з тригеру "**New subscription in Stripe**".
  
  <img src = "img/new15_2.png">  
  
  **Stripe customer id** обираємо як значення поля **Customer id** з тригеру "**New subscription in Stripe**".
  
  <img src = "img/new16_2.png">
  
Значення поля **Group** обираємо з випадаючого списку, який включає всі групи в даному акаунті (обираємо відповідно **Self Study**).
  
  <img src = "img/new17_2.png">
  
Після додавання всіх параметрів для продовження натиснемо кнопку **Continue**.
  
  <img src = "img/new18_2.png">
  
Як і для інших елементів для Action **Assign User to Group** потрібно зробити перевірку.
  
  <img src = "img/new18_2_2.png">
  
Якщо перевірка пройшла успішно (1) у нас з'являються кнопка **Publish**, яка публікує відпоідний **Flow**, тобто робить його працюючим.
  
  <img src = "img/new19_2.png">
  
Отже ми отримуємо працюючий **Zap**
  
  <img src = "img/new20_2.png">
  
  
У будь-якого **Zap** ми можемо змінити ім'я.  
  <img src = "img/new20.png">
  
   Краще, якщо за іменем буде зрозуміло повний функціонал **Zap**.  
  
  <img src = "img/new21.png">
  
  ### Відписка від групи
Для формування Zap із відпискою - зручно робити копію **Zap** із підпискою. Це відбувається через те, що в Zap із підпискою вже внесено ID продукту і при його копіюуванні його не потрібно буде шукати і вносити по новій.  
Отже, попіюємо Zap із підпискою.
  
  <img src = "img/new22_2.png">  
  
  <img src = "img/new22_3.png">
  
Та змінюємо назву

  <img src = "img/new22_4.png">
  
  <img src = "img/new22_5.png">
  
Далі - змінюємо подію **New Subscription** шляхом натискання на відпоідний блок.
  <img src = "img/new22.png">
  
Після натискання на тригер **New Subscription** відкривається службове віконце справа в якому ми змінюємо значення поля **Trigger event** (1) на **Cancel Subscription** (2).
  <img src = "img/new23.png">
  
Як звично - тестуємо новий тригер.
  <img src = "img/new24.png">
  
Якщо дані існують, продовжуємо із обраним записом (**Continue with select record**).
  <img src = "img/new25.png">
  
Якщо це новий акаунт і в ньому не відбувалося жодної відміни підписки це варто зробити примусово в **Stripe** в розділі **Subscription** у відповідного користувача натиснути **Cancel Subscription** (скасування підписки)
  
  <img src = "img/new25_2.png">
  
Серед варіантів скасування підписку обираємо **Immediatly** (негайно)  
  <img src = "img/new25_3.png">
  
Як вже сказано вище, прикопіюванні **Zap** із підпискою фільтр вже налаштовано на потрібний продукт  
  <img src = "img/new26.png">
  
Залишається змінити подію, що має відбуватися з **Assign User to Group** на  **Unassign User From Group**
  <img src = "img/new27.png">
  
В якій так само, обираємо  **Email** користувача
<img src = "img/new28.png">
А також групу, від якої відписуємо.
  <img src = "img/new29.png">
  
Тестуємо новий крок.
  
  <img src = "img/new30.png">
  
За умови успіху (1) продовжуємо створювати Zap, натискаючи кнопку **Continue** (2)
  <img src = "img/new31.png">
  
В кінці публікуємо **Zap**, натискаючи кнопку **Publish**
  <img src = "img/new32.png">
  
Після успішної публікації **Zap** починає працювати
<img src = "img/new33.png">
  
  ## Stripe
### Products
В даному прикладі продукти вже створені:
  <img src = "img/new07.png">  
  
Для того, щоб клієнт міг зробити покупку необхідно мати платіжне посилання (**Payment Link**).  Його необхідно створити на відповідній сторінці в **Stripe**.  
  <img src = "img/new08.png">   
  
Для створення посилання до нього потрібно додати відповідний продукт:  
  <img src = "img/new09.png">  
  
Для того, щоб можна було користуватися промокодами навпроти відповідного пункту треба позначити чекбокс

  <img src = "img/new10.png">  
  
  ## Створення Zap (підключення Drived)
  
  